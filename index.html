<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LINEé¢¨ãƒˆãƒ¼ã‚¯å‹•ç”»ãƒ¡ãƒ¼ã‚«ãƒ¼ Ver.22 (ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¯¾å¿œ)</title>
<style>
    /* --------------------------------------------------
       è¨­å®šã‚¨ãƒªã‚¢
    -------------------------------------------------- */
    :root {
        --bg-color: #8CABD9;       /* èƒŒæ™¯è‰² */
        --me-bubble: #6DE67C;      /* è‡ªåˆ†ã®å¹ãå‡ºã—è‰² */
        --partner-bubble: #FFFFFF; /* ç›¸æ‰‹ã®å¹ãå‡ºã—è‰² */
        --default-icon: #000000;   /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³è‰² */
        --text-color: #000000;     /* æ–‡å­—è‰² */
    }

    * { box-sizing: border-box; }

    body {
        background-color: var(--bg-color);
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", sans-serif;
        margin: 0; padding: 0;
        display: flex; flex-direction: column; align-items: center;
        min-height: 100vh;
    }
    
    .container {
        width: 100%; max-width: 450px;
        background-color: var(--bg-color);
        padding-top: 100px; padding-bottom: 120px; 
        padding-left: 15px; padding-right: 15px;
    }
    
    /* --------------------------------------------------
       ãƒãƒ£ãƒƒãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«
    -------------------------------------------------- */
    .chat-row { display: flex; margin-bottom: 10px; width: 100%; animation: slideIn 0.4s cubic-bezier(0.25, 1, 0.5, 1); }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .bubble {
        position: relative; padding: 10px 14px; border-radius: 18px; 
        font-size: 15px; line-height: 1.4; color: var(--text-color); 
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        max-width: 15em; word-wrap: break-word; 
    }
    .time { font-size: 10px; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .read-mark { font-size: 10px; color: #fff; margin-bottom: 2px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.1); text-align: right; white-space: nowrap; }
    .name { font-size: 11px; color: #555; margin-bottom: 4px; margin-left: 2px; }

    /* ç›¸æ‰‹ */
    .left { justify-content: flex-start; }
    .left .chat-content { display: flex; flex-direction: column; align-items: flex-start; }
    .left .bubble { background-color: var(--partner-bubble); border-radius: 18px; }
    .left .row-bottom { display: flex; align-items: flex-end; }
    .left .time { margin-left: 6px; margin-bottom: 2px; }
    .left .avatar {
        width: 40px; height: 40px; background-color: var(--default-icon); border-radius: 50%;
        margin-right: 10px; flex-shrink: 0; overflow: hidden; display: flex; align-items: center; justify-content: center;
    }
    .left .avatar img { width: 100%; height: 100%; object-fit: cover; }

    /* è‡ªåˆ† */
    .right { justify-content: flex-end; }
    .right .chat-content { display: flex; flex-direction: row; align-items: flex-end; }
    .right .bubble { background-color: var(--me-bubble); border-radius: 18px; margin-right: 0; }
    .right .info-column { display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-end; margin-right: 6px; margin-bottom: 2px; }

    /* â˜…ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå‚åŠ ãƒ»é€€å‡ºãªã©ï¼‰ */
    .system-row {
        justify-content: center; /* ä¸­å¤®å¯„ã› */
        margin-bottom: 15px;
    }
    .system-bubble {
        background-color: rgba(0, 0, 0, 0.2); /* åŠé€æ˜ã®é»’ã‚°ãƒ¬ãƒ¼ */
        color: #fff;
        padding: 4px 16px;
        border-radius: 20px;
        font-size: 12px;
        text-align: center;
        max-width: 80%;
    }
    .system-time {
        display: block;
        font-size: 11px;
        margin-bottom: 2px;
        opacity: 0.9;
    }

    /* --------------------------------------------------
       UIãƒ‘ãƒ¼ãƒ„
    -------------------------------------------------- */
    .upload-box {
        background: rgba(255, 255, 255, 0.98);
        padding: 30px; border-radius: 16px;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        width: 90%; max-width: 480px;
        position: fixed; top: 50%; left: 50%; 
        transform: translate(-50%, -50%); z-index: 100;
        display: flex; flex-direction: column; gap: 15px;
        max-height: 95vh; overflow-y: auto;
    }
    h2 { margin: 0 0 5px 0; font-size: 20px; color: #333; }
    .step-section { border: 1px solid #e1e4e8; border-radius: 8px; padding: 15px; background: #fdfdfd; text-align: left; }
    .step-label { font-size: 13px; color: #333; font-weight: bold; display: block; margin-bottom: 10px; border-left: 4px solid #4b7bec; padding-left: 8px; }
    .btn, .input-text { padding: 12px; border-radius: 6px; font-weight: bold; font-size: 13px; width: 100%; border: 1px solid #ccc; margin-bottom: 8px; }
    .input-text { background: #fff; color: #333; }
    .btn { cursor: pointer; border: none; text-decoration: none; display: block; transition: 0.2s; line-height: 1.4; }
    .btn-white { background-color: #fff; border: 1px solid #ccc; color: #333; } .btn-white:hover { background-color: #f0f0f0; }
    .btn-blue { background-color: #4b7bec; color: white; } .btn-blue:hover { background-color: #3867d6; }
    .file-input-container { position: relative; overflow: hidden; display: block; width: 100%; margin-bottom: 8px; }
    .file-input-container input[type=file] { position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
    .file-visual-btn { background-color: #4b7bec; color: white; padding: 12px; border-radius: 6px; font-weight: bold; font-size: 13px; display: block; text-align: center; }
    .file-visual-btn:hover { background-color: #3867d6; }
    .status-msg { font-size: 11px; color: #06c755; margin-bottom: 5px; height: auto; white-space: pre-wrap; line-height: 1.4; }
    .divider { display: flex; align-items: center; color: #999; font-size: 11px; margin: 10px 0; }
    .divider::before, .divider::after { content: ""; flex: 1; border-bottom: 1px solid #ddd; }
    .divider::before { margin-right: 10px; } .divider::after { margin-left: 10px; }
    .guide-details { background: #f4f7fa; border-radius: 6px; padding: 8px; margin-bottom: 10px; border: 1px solid #e1e4e8; }
    .guide-details summary { font-size: 11px; font-weight: bold; color: #4b7bec; cursor: pointer; outline: none; }
    .guide-content { font-size: 11px; color: #555; line-height: 1.5; margin-top: 8px; padding-left: 5px;}
    .guide-content ol { padding-left: 20px; margin: 5px 0; }
    .btn-start { background-color: #06c755; color: white; margin-top: 5px; font-size: 16px; padding: 15px; }
    .btn-start:disabled { background-color: #ccc; cursor: not-allowed; opacity: 0.7; }
    .btn-start:not(:disabled):hover { background-color: #05b34c; }
    
    .operation-guide { position: fixed; top: 15px; left: 15px; background: rgba(0, 0, 0, 0.6); color: #fff; padding: 10px 15px; border-radius: 8px; font-size: 13px; line-height: 1.6; z-index: 90; backdrop-filter: blur(4px); display: none; }
    .key-badge { background: #fff; color: #333; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 11px; margin-right: 4px; }
    
    .control-panel { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 12px; z-index: 200; display: none; text-align: center; backdrop-filter: blur(4px); }
    .btn-record { background-color: #ff4757; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    .btn-record:hover { background-color: #ff6b81; }
    .status-text { color: white; font-size: 12px; margin-top: 8px; }

</style>
</head>
<body>

<div class="upload-box" id="uploadArea">
    <h2>ãƒˆãƒ¼ã‚¯å‹•ç”»ãƒ¡ãƒ¼ã‚«ãƒ¼</h2>

    <div class="step-section">
        <span class="step-label">â‘  ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ (ä»»æ„)</span>
        <div class="file-input-container">
            <div class="file-visual-btn">ğŸ‘¤ ç”»åƒã‚’ã¾ã¨ã‚ã¦é¸æŠ...</div>
            <input type="file" id="iconInput" accept="image/*" multiple>
        </div>
        <div class="status-msg" id="iconStatus"></div>
    </div>

    <div class="step-section">
        <span class="step-label">â‘¡ ãƒˆãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿</span>

        <div style="margin-bottom: 15px;">
            <button class="btn btn-white" onclick="downloadCsvTemplate()">
                ğŸ“¥ ãƒ†ãƒ³ãƒ—ãƒ¬(CSV)ã‚’DL
            </button>
            <div class="file-input-container">
                <div class="file-visual-btn">ğŸ“„ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                <input type="file" id="fileInput" accept=".csv">
            </div>
            <div class="status-msg" id="fileStatus"></div>
        </div>

        <div class="divider">ã¾ãŸã¯</div>

        <div>
            <details class="guide-details">
                <summary>ğŸ’¡ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ä½¿ã„æ–¹ (ã‚¯ãƒªãƒƒã‚¯)</summary>
                <div class="guide-content">
                    <button class="btn btn-white" onclick="copyTableData()" style="font-size:10px; padding:5px;">
                        ğŸ“‹ ã‚³ãƒ”ãƒ¼ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    </button>
                    <div id="copyStatus" style="color:#06c755;"></div>
                    <div style="margin-top:5px; font-size:10px;">
                        â€»åå‰ã‚’ã€ŒSystemã€ã«ã™ã‚‹ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã«ãªã‚Šã¾ã™
                    </div>
                    <br>
                    <strong>å…¬é–‹æ‰‹é †:</strong>
                    <ol>
                        <li>[ãƒ•ã‚¡ã‚¤ãƒ«] â†’ [å…±æœ‰] â†’ [Webã«å…¬é–‹]</li>
                        <li>å½¢å¼: <strong>[ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šå½¢å¼ (.csv)]</strong></li>
                        <li>URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ä»˜</li>
                    </ol>
                </div>
            </details>
            <input type="text" id="urlInput" class="input-text" placeholder="https://docs.google.com/.../pub?output=csv">
            <div class="status-msg" id="urlStatus"></div>
        </div>
    </div>

    <button id="startBtn" class="btn btn-start" disabled onclick="startTool()">
        ãƒˆãƒ¼ã‚¯ç”»é¢ã‚’ä½œæˆ â–¶
    </button>
</div>

<div class="operation-guide" id="guideArea">
    <div style="margin-bottom:5px; font-weight:bold; border-bottom:1px solid rgba(255,255,255,0.3);">æ“ä½œã‚¬ã‚¤ãƒ‰</div>
    <div><span class="key-badge">Enter</span> ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€²ã‚€</div>
    <div><span class="key-badge">Backspace</span> ã²ã¨ã¤æˆ»ã‚‹</div>
</div>

<div class="control-panel" id="controlPanel">
    <button class="btn-record" id="recordBtn" onclick="startRecording()">â— éŒ²ç”»ï¼†è‡ªå‹•å†ç”Ÿ</button>
    <div class="status-text" id="statusText">7æ–‡å­—ã”ã¨ã«+0.5ç§’</div>
</div>

<div class="container" id="chatArea"></div>

<script>
    let chatData = [];
    let userIcons = {}; 
    let uploadedCsvText = null;
    let currentIndex = 0;
    let autoPlayTimeout = null;
    let mediaRecorder = null;
    let recordedChunks = [];

    // --- CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL ---
    function downloadCsvTemplate() {
        const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
        const dataLines = [
            "Who,Message,Time,ReadCount",
            "è‡ªåˆ†,ã‚¹ãƒŠã‚³ãƒãƒã‚µãƒŒã‚­ã•ã‚“ã‚’æ‹›å¾…ã—ã¾ã—ãŸã€‚,17:40,",
            "System,ã‚¹ãƒŠã‚³ãƒãƒã‚µãƒŒã‚­ãŒå‚åŠ ã—ã¾ã—ãŸã€‚,17:41,",
            "ã‚¹ãƒŠã‚³ãƒãƒã‚µãƒŒã‚­,ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼,17:42,2",
            "System,ã‚¹ãƒŠã‚³ãƒãƒã‚µãƒŒã‚­ãŒé€€å‡ºã—ã¾ã—ãŸã€‚,17:43,"
        ];
        const content = dataLines.join("\n");
        const blob = new Blob([bom, content], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "system_msg_sample.csv";
        a.click();
        URL.revokeObjectURL(url);
    }

    // --- ã‚³ãƒ”ãƒ¼ç”¨ãƒ‡ãƒ¼ã‚¿ ---
    function copyTableData() {
        const dataLines = [
            "Who\tMessage\tTime\tReadCount",
            "è‡ªåˆ†\tã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ\t10:00\t",
            "System\tã€‡ã€‡ãŒé€€å‡ºã—ã¾ã—ãŸã€‚\t10:01\t",
            "è‡ªåˆ†\tã“ã‚“ãªæ„Ÿã˜ã§ã‚°ãƒ¬ãƒ¼ã®è¡¨ç¤ºã«ãªã‚Šã¾ã™\t10:02\t"
        ];
        const text = dataLines.join("\n");
        navigator.clipboard.writeText(text).then(() => {
            const status = document.getElementById('copyStatus');
            status.innerText = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼";
            setTimeout(() => { status.innerText = ""; }, 2000);
        });
    }

    // --- ã‚¢ã‚¤ã‚³ãƒ³èª­ã¿è¾¼ã¿ ---
    document.getElementById('iconInput').addEventListener('change', function(e) {
        const files = e.target.files;
        if (!files || files.length === 0) return;
        let loadedCount = 0;
        const total = files.length;
        let names = [];
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(evt) {
                const name = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
                userIcons[name] = evt.target.result;
                loadedCount++;
                names.push(name);
                if (loadedCount === total) {
                    document.getElementById('iconStatus').innerText = `ã‚»ãƒƒãƒˆå®Œäº† (${total}ä»¶):\n` + names.join(", ");
                }
            };
            reader.readAsDataURL(file);
        });
    });

    // --- CSVèª­ã¿è¾¼ã¿ ---
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
            uploadedCsvText = evt.target.result;
            document.getElementById('fileStatus').innerText = "èª­è¾¼å®Œäº†: " + file.name;
            document.getElementById('urlInput').value = "";
            document.getElementById('urlStatus').innerText = "";
            document.getElementById('startBtn').disabled = false;
        };
        reader.readAsText(file);
    });

    document.getElementById('urlInput').addEventListener('input', function(e) {
        const url = e.target.value.trim();
        const btn = document.getElementById('startBtn');
        if (url.length > 5) {
            document.getElementById('fileInput').value = "";
            uploadedCsvText = null;
            document.getElementById('fileStatus').innerText = "";
            document.getElementById('urlStatus').innerText = "URLå…¥åŠ›ã‚ã‚Š";
            btn.disabled = false;
        } else {
            if (!uploadedCsvText) btn.disabled = true;
            document.getElementById('urlStatus').innerText = "";
        }
    });

    // --- ã‚¹ã‚¿ãƒ¼ãƒˆå‡¦ç† ---
    async function startTool() {
        const url = document.getElementById('urlInput').value.trim();
        const btn = document.getElementById('startBtn');
        if (uploadedCsvText) {
            parseCSV(uploadedCsvText);
            startDisplay();
            return;
        }
        if (url) {
            if (!url.includes('output=csv')) {
                alert("URLã‚¨ãƒ©ãƒ¼: æœ«å°¾ãŒ output=csv ã®URLã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„");
                return;
            }
            btn.innerText = "èª­ã¿è¾¼ã¿ä¸­...";
            btn.disabled = true;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼");
                const csvText = await response.text();
                parseCSV(csvText);
                startDisplay();
            } catch (err) {
                alert("èª­ã¿è¾¼ã¿å¤±æ•—: " + err.message);
                btn.innerText = "ãƒˆãƒ¼ã‚¯ç”»é¢ã‚’ä½œæˆ â–¶";
                btn.disabled = false;
            }
            return;
        }
    }

    function startDisplay() {
        if (chatData.length === 0) {
            alert("ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
            return;
        }
        document.getElementById('uploadArea').style.display = 'none';
        document.getElementById('controlPanel').style.display = 'block';
        document.getElementById('guideArea').style.display = 'block';
    }

    // --- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»éŒ²ç”» ---
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('uploadArea').style.display !== 'none') return;
        if (e.key === 'Enter') { e.preventDefault(); showMessage(); }
        else if (e.key === 'Backspace') { e.preventDefault(); hideMessage(); }
    });

    async function startRecording() {
        try {
            const stream = await navigator.mediaDevices.getDisplayMedia({ video: { mediaSource: "screen" } });
            document.getElementById('controlPanel').style.display = 'none';
            document.getElementById('guideArea').style.display = 'none';

            mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
            recordedChunks = [];
            mediaRecorder.ondataavailable = e => { if (e.data.size > 0) recordedChunks.push(e.data); };
            mediaRecorder.onstop = saveVideo;
            mediaRecorder.start();

            setTimeout(processNextMessage, 1000);
        } catch (err) {
            alert("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");
            document.getElementById('controlPanel').style.display = 'block';
            document.getElementById('guideArea').style.display = 'block';
        }
    }

    function processNextMessage() {
        if (!showMessage()) { setTimeout(finishRecording, 2000); return; }
        const lastMsg = chatData[currentIndex - 1];
        const wait = Math.max(0.5, Math.ceil(lastMsg.msg.length / 7) * 0.5) * 1000;
        autoPlayTimeout = setTimeout(processNextMessage, wait);
    }

    function finishRecording() {
        if (autoPlayTimeout) clearTimeout(autoPlayTimeout);
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(t => t.stop());
        }
    }

    function saveVideo() {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none'; a.href = url; a.download = 'line_talk_movie.webm';
        document.body.appendChild(a); a.click();
        setTimeout(() => {
            window.URL.revokeObjectURL(url);
            document.getElementById('controlPanel').style.display = 'block';
            document.getElementById('guideArea').style.display = 'block';
            document.getElementById('statusText').innerText = "ä¿å­˜å®Œäº†";
        }, 100);
    }

    function parseCSV(csvText) {
        const rows = csvText.trim().replace(/\r\n/g, '\n').split('\n');
        chatData = [];
        for (let i = 1; i < rows.length; i++) {
            let cols = rows[i].split(',');
            if (cols.length < 2) continue;
            const clean = s => s ? s.trim().replace(/^"|"$/g, '') : '';
            const readCount = cols[3] ? clean(cols[3]) : '';
            chatData.push({ 
                who: clean(cols[0]), 
                msg: clean(cols[1]), 
                time: cols[2] ? clean(cols[2]) : '',
                readCount: readCount
            });
        }
        currentIndex = 0;
    }

    function showMessage() {
        if (currentIndex >= chatData.length) return false;
        const data = chatData[currentIndex];
        const chatArea = document.getElementById('chatArea');
        const isMe = ['Me', 'me', 'è‡ªåˆ†', 'Self'].includes(data.who);
        
        let html = '';

        // â˜…ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ¤å®š
        if (data.who === 'System' || data.who === 'ã‚·ã‚¹ãƒ†ãƒ ') {
            // æ™‚é–“ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤ºã€ãªã‘ã‚Œã°è¡¨ç¤ºã—ãªã„
            const timeHtml = data.time ? `<span class="system-time">${data.time}</span>` : '';
            html = `
            <div class="chat-row system-row">
                <div class="system-bubble">
                    ${timeHtml}
                    <div>${data.msg}</div>
                </div>
            </div>`;
        } else if (isMe) {
            let readText = 'æ—¢èª­';
            if (data.readCount && data.readCount.length > 0) readText += ' ' + data.readCount;
            html = `
            <div class="chat-row right">
                <div class="chat-content">
                    <div class="info-column">
                        <span class="read-mark">${readText}</span>
                        <span class="time">${data.time}</span>
                    </div>
                    <div class="bubble">${data.msg}</div>
                </div>
            </div>`;
        } else {
            const iconUrl = userIcons[data.who];
            const avatarHtml = iconUrl ? `<img src="${iconUrl}">` : ``;
            html = `<div class="chat-row left"><div class="avatar">${avatarHtml}</div><div class="chat-content"><div class="name">${data.who}</div><div class="row-bottom"><div class="bubble">${data.msg}</div><span class="time">${data.time}</span></div></div></div>`;
        }
        chatArea.insertAdjacentHTML('beforeend', html);
        currentIndex++;
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        return true;
    }

    function hideMessage() {
        if (currentIndex <= 0) return;
        document.getElementById('chatArea').lastElementChild.remove();
        currentIndex--;
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }
</script>
</body>
</html>
